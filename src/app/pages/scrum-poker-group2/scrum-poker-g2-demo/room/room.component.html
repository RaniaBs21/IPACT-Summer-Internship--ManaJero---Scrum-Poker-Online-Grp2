<body>
<div class="container">
  <!-----------------------------------  header ------------------------------->
  <div class="topnav">
    <div class="dropdown-container">
      <span class="session-name">{{ session?.name }}</span>
      <button
        class="btn btn-link dropdown-toggle"
        style="color: dimgrey"
        type="button"
        id="dropdownMenuButton"
        data-bs-toggle="dropdown"
        aria-expanded="false"
        (click)="toggleDropdownSession()"
      ></button>
      <ul *ngIf="isDropdownOpen" class="dropdown-content">
        <li (click)="openSessionUpdate(session)">
          <i class="fas fa-cog"></i> Game settings
        </li>
        <li>
          <i class="fas fa-history"></i> Voting History
        </li>
      </ul>
    </div>

    <!-- Sous-titre pour le voting -->
    <div *ngIf="selectedIssue" class="voting-subtitle">
      Voting: {{ selectedIssue.issueDescription }}
    </div>

    <button class="custom-button" (click)="toggleSidebar()">
      <img
        src="assets/images/menu.png"
        style="width: 45px; height: 40px"
        class="button-icon"
        alt="desc"
      />
    </button>
    <button class="custom-button" (click)="openInvitePlayers()">
      <img
        src="assets/images/invitation.png"
        style="width: 45px; height: 45px"
        class="button-icon"
        alt="desc"
      />
      Invite players
    </button>
  </div>
</div>

<!------------------------------  pick your card --------------------------------->
<div class="button-container">
  <div class="button-wrapper">
    <br>
    <h1 *ngIf="!revealedCard && selectedCard === null">
      <span>P</span><span>I</span><span>C</span><span>K</span><span> </span><span>Y</span><span>O</span><span>U</span><span>R</span><span> </span><span>C</span><span>A</span><span>R</span><span>D</span><span>S</span><span>!</span>
    </h1>
    <button *ngIf="selectedCard !== null && !revealedCard" (click)="revealCard()" class="neon-shadow">
      Reveal card
    </button>
    <br>
    <button *ngIf="revealedCard" (click)="revealCard()" class="reveal-button" routerLink="createGame">
      Start new voting
    </button>
  </div>
  <div class="container">
    <h1 *ngIf="revealedCard">
      <span>Your selected card: {{ revealedCard }}</span>
    </h1>

    <div class="average-agreement" *ngIf="revealedCard">
      <div class="average">
        <h5 style="color: #3A3A3A">Average:</h5>
<!--        <h3>{{ calculateAverage(votes) }}</h3>-->
              <h3>{{ revealedCard }}</h3>
      </div>
      <div class="vote">
        <h5 style="color: #3A3A3A">Vote:</h5>
        <h3>{{ revealedCard }}</h3>
      </div>
    </div>
  </div>
</div>

<!----------------------------------  algo cards --------------------------------->
<div class="cards">
  <div class="group relative h-40 cursor-pointer" *ngFor="let card of cards" [id]="'vote_card_' + card" (click)="selectCard(card)" [style.opacity]="selectedCard === card ? '1' : '0.5'"
       [ngClass]="{'selected': selectedCard === card}">
    <button class="card-button">{{ card }}</button>
  </div>
</div>

<!------------------------------------------ Sidebar : issues --------------------------------->
<div class="sidebar" [class.open]="isSidebarOpen">
  <div class="sidebar-header">
    <h2>Issues</h2>
  </div>
  <div class="sidebar-content">
    <div class="header-container">
      <h5>Issues</h5>
      <div class="dropdown-container">
        <img src="assets/images/import.png" width="50" height="50" class="spaced-img" (click)="toggleDropdown()" style="cursor:pointer;" alt="desc">
        <ul *ngIf="isDropdownOpen" class="dropdown-content">
          <li (click)="selectOption('jira')">Import from JIRA</li>
          <li (click)="selectOption('linear')">Import from Linear</li>
          <li (click)="selectOption('urls')">Add from URLs</li>
          <li (click)="selectOption('csv')">Import from CSV</li>
        </ul>
      </div>
      <img src="assets/images/close.png" width="70" height="50" (click)="toggleSidebar()" class="close-button" alt="desc">
    </div>
    <button class="btn btn-light" *ngIf="!showForm" (click)="toggleForm()">
      <img src="assets/images/addUserStory.png" width="45" height="45" alt="desc">
      Add An Issue
    </button>

    <!------------------------------ add issue form ------------------------->
    <div *ngIf="showForm" class="issue-form">
      <div class="scrollable-issues">
        <div *ngFor="let issue of issues" class="issue-item">
          <div class="issue-card">
            <p class="issue-number">{{ issue.issueNumber }}</p>
            <div class="row">
              <br>
              <p style="line-height: 1.75; color:black;font-size:20px; margin-top:18px">{{ issue.issueDescription }}</p>
              <button class="btn" (click)="toggleVote(issue)">
                {{ issue.isVoting ? 'Voting now...' : issue.hasVoted ? 'Vote again' : 'Vote' }}
              </button>


              <!------------------------------ dropdopwn ------------------------->

              <div class="dropdown-container">
                <button class="btn btn-link" (click)="toggleDropdownIssue(issue.id)">
                  <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul *ngIf="dropdownOpen[issue.id]" class="dropdown-content">
                  <li (click)="openIssueUpdate(issue)">
                    <i class="fas fa-edit"></i> Update
                  </li>
                  <li (click)="moveIssueToTop(issue.id)">
                    <i class="fas fa-arrow-up"></i> Move to Top
                  </li>
                  <li (click)="moveIssueToBottom(issue.id)">
                    <i class="fas fa-arrow-down"></i> Move to Bottom
                  </li>
                  <li (click)="deleteIssue(issue.id)">
                    <i class="fas fa-trash-alt"></i> Delete
                  </li>
                </ul>
              </div>

            </div>
          </div>
        </div>

        <!------------------------------------------------------->

        <nb-card-body>
          <form [formGroup]="addIssuesForm">
            <div class="form-group">
              <textarea rows="5" nbInput fullWidth shape="round" formControlName="issueDescription" placeholder="Enter a new issue"></textarea>
            </div>
          </form>
        </nb-card-body>
        <nb-card-footer class="footer-buttons">
          <div class="button-group">
            <button (click)="confirmIssueAdd()" class="btn btn-primary">Save</button>
            <button (click)="cancel()" class="btn btn-light">Cancel</button>
          </div>
        </nb-card-footer>
      </div>
    </div>
  </div>
</div>

<!------------------------------------ Overlay ------------------------------------>
<div class="overlay" [class.show]="isSidebarOpen" (click)="toggleSidebar()"></div>
</body>

<!----------------------------------- Close button ------------------------------------>
<button class="close-button" style="background-color: orange" routerLink="result">
  <i class="fas fa-times"></i>
  Close Session
</button>
